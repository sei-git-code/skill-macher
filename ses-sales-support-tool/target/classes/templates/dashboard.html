<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ダッシュボード - SES営業支援ツール</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link href="/css/style.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="bi bi-people-fill me-2"></i>SES営業支援ツール
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link active" href="/">
                <i class="bi bi-speedometer2 me-1"></i>ダッシュボード
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/job-requirements">
                <i class="bi bi-briefcase me-1"></i>ジョブ要件
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/employees">
                <i class="bi bi-person-badge me-1"></i>従業員
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/matching">
                <i class="bi bi-diagram-3 me-1"></i>マッチング
              </a>
            </li>
          </ul>

          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-person-circle me-1"></i>ユーザー
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="/profile">
                    <i class="bi bi-person me-2"></i>プロフィール
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="/settings">
                    <i class="bi bi-gear me-2"></i>設定
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="/auth/logout">
                    <i class="bi bi-box-arrow-right me-2"></i>ログアウト
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container-fluid py-4">
      <!-- Page Header -->
      <div class="row mb-4">
        <div class="col">
          <h1 class="h3 mb-0">
            <i class="bi bi-speedometer2 me-2"></i>ダッシュボード
          </h1>
          <p class="text-muted">システムの概要と統計情報</p>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="row mb-4">
        <!-- Job Requirements Stats -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div
                    class="text-xs font-weight-bold text-primary text-uppercase mb-1"
                  >
                    ジョブ要件
                  </div>
                  <div
                    class="h5 mb-0 font-weight-bold text-gray-800"
                    th:text="${stats.totalJobRequirements}"
                  >
                    0
                  </div>
                </div>
                <div class="col-auto">
                  <i class="bi bi-briefcase fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Employees Stats -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div
                    class="text-xs font-weight-bold text-success text-uppercase mb-1"
                  >
                    従業員
                  </div>
                  <div
                    class="h5 mb-0 font-weight-bold text-gray-800"
                    th:text="${stats.totalEmployees}"
                  >
                    0
                  </div>
                </div>
                <div class="col-auto">
                  <i class="bi bi-person-badge fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Matching Results Stats -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div
                    class="text-xs font-weight-bold text-info text-uppercase mb-1"
                  >
                    マッチング結果
                  </div>
                  <div
                    class="h5 mb-0 font-weight-bold text-gray-800"
                    th:text="${stats.totalMatchingResults}"
                  >
                    0
                  </div>
                </div>
                <div class="col-auto">
                  <i class="bi bi-diagram-3 fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Users Stats -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div
                    class="text-xs font-weight-bold text-warning text-uppercase mb-1"
                  >
                    ユーザー
                  </div>
                  <div
                    class="h5 mb-0 font-weight-bold text-gray-800"
                    th:text="${stats.totalUsers}"
                  >
                    0
                  </div>
                </div>
                <div class="col-auto">
                  <i class="bi bi-people fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="row mb-4">
        <!-- Job Status Distribution -->
        <div class="col-xl-6 col-lg-7">
          <div class="card shadow mb-4">
            <div
              class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
            >
              <h6 class="m-0 font-weight-bold text-primary">
                ジョブ要件ステータス分布
              </h6>
            </div>
            <div class="card-body">
              <div class="chart-pie pt-4 pb-2">
                <canvas id="jobStatusChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Employee Type Distribution -->
        <div class="col-xl-6 col-lg-5">
          <div class="card shadow mb-4">
            <div
              class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
            >
              <h6 class="m-0 font-weight-bold text-primary">雇用形態分布</h6>
            </div>
            <div class="card-body">
              <div class="chart-pie pt-4 pb-2">
                <canvas id="employeeTypeChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="row">
        <!-- Recent Job Requirements -->
        <div class="col-lg-6 mb-4">
          <div class="card shadow mb-4">
            <div
              class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
            >
              <h6 class="m-0 font-weight-bold text-primary">
                最近のジョブ要件
              </h6>
              <a href="/job-requirements" class="btn btn-sm btn-primary"
                >すべて表示</a
              >
            </div>
            <div class="card-body">
              <div
                th:if="${recentActivity.recentJobRequirements != null and !recentActivity.recentJobRequirements.empty}"
              >
                <div
                  th:each="job : ${recentActivity.recentJobRequirements}"
                  class="d-flex align-items-center mb-3"
                >
                  <div class="flex-shrink-0">
                    <i class="bi bi-briefcase text-primary"></i>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <div class="fw-bold" th:text="${job.title}">
                      ジョブタイトル
                    </div>
                    <div class="text-muted small" th:text="${job.clientName}">
                      クライアント名
                    </div>
                  </div>
                  <div class="flex-shrink-0">
                    <span
                      class="badge"
                      th:classappend="${job.status.name() == 'OPEN'} ? 'bg-success' : 'bg-secondary'"
                      th:text="${job.status.name()}"
                      >ステータス</span
                    >
                  </div>
                </div>
              </div>
              <div
                th:if="${recentActivity.recentJobRequirements == null or recentActivity.recentJobRequirements.empty}"
                class="text-center text-muted"
              >
                <i class="bi bi-inbox fa-2x mb-2"></i>
                <p>最近のジョブ要件はありません</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Employees -->
        <div class="col-lg-6 mb-4">
          <div class="card shadow mb-4">
            <div
              class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
            >
              <h6 class="m-0 font-weight-bold text-primary">最近の従業員</h6>
              <a href="/employees" class="btn btn-sm btn-primary">すべて表示</a>
            </div>
            <div class="card-body">
              <div
                th:if="${recentActivity.recentEmployees != null and !recentActivity.recentEmployees.empty}"
              >
                <div
                  th:each="employee : ${recentActivity.recentEmployees}"
                  class="d-flex align-items-center mb-3"
                >
                  <div class="flex-shrink-0">
                    <i class="bi bi-person-badge text-success"></i>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <div class="fw-bold" th:text="${employee.fullName}">
                      従業員名
                    </div>
                    <div class="text-muted small" th:text="${employee.email}">
                      メールアドレス
                    </div>
                  </div>
                  <div class="flex-shrink-0">
                    <span
                      class="badge"
                      th:classappend="${employee.status.name() == 'ACTIVE'} ? 'bg-success' : 'bg-secondary'"
                      th:text="${employee.status.name()}"
                      >ステータス</span
                    >
                  </div>
                </div>
              </div>
              <div
                th:if="${recentActivity.recentEmployees == null or recentActivity.recentEmployees.empty}"
                class="text-center text-muted"
              >
                <i class="bi bi-inbox fa-2x mb-2"></i>
                <p>最近の従業員はありません</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-light text-center py-3 mt-5">
      <div class="container">
        <p class="text-muted mb-0">
          &copy; 2024 SES営業支援ツール. All rights reserved.
        </p>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom JS -->
    <script src="/js/app.js"></script>

    <script>
      // Job Status Chart
      const jobStatusCtx = document
        .getElementById("jobStatusChart")
        .getContext("2d");
      const jobStatusChart = new Chart(jobStatusCtx, {
        type: "doughnut",
        data: {
          labels: ["オープン", "進行中", "クローズ", "キャンセル"],
          datasets: [
            {
              data: [
                /*[[${stats.openJobRequirements}]]*/ 0,
                /*[[${stats.inProgressJobRequirements}]]*/ 0,
                /*[[${stats.closedJobRequirements}]]*/ 0, 0,
              ],
              backgroundColor: ["#28a745", "#ffc107", "#6c757d", "#dc3545"],
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
        },
      });

      // Employee Type Chart
      const employeeTypeCtx = document
        .getElementById("employeeTypeChart")
        .getContext("2d");
      const employeeTypeChart = new Chart(employeeTypeCtx, {
        type: "pie",
        data: {
          labels: ["正社員", "契約社員", "パートタイム", "インターン"],
          datasets: [
            {
              data: [/*[[${stats.activeEmployees}]]*/ 0, 0, 0, 0],
              backgroundColor: ["#007bff", "#28a745", "#ffc107", "#17a2b8"],
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
        },
      });
    </script>
  </body>
</html>
